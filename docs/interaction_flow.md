# 塔罗占卜交互流程

## 用户体验流程

```
1. 用户输入 /tarot 我应该换工作吗？
   ↓
2. 显示抽牌按钮
   "请在心中默念你的问题，准备好时点击【🎴 抽牌】"
   ↓
3. 点击抽牌按钮
   ↓
4. 洗牌动画（4个阶段，每个1秒）
   "🔮 正在为你连接宇宙的能量..."
   "✨ 塔罗之灵正在聆听你的问题..."
   "🌙 牌阵已开启，智慧即将显现..."
   "🎴 命运之轮转动，答案浮现..."
   ↓
5. 显示精简版结果
   ━━━━━━━━━━━━━━━━━
   🔮 塔罗占卜结果 🔮
   ━━━━━━━━━━━━━━━━━
   
   💭 你的问题
   我应该换工作吗？
   
   ━━━━━━━━━━━━━━━━━
   
   ⚠️ 总体预测：谨慎
   需要深思熟虑，避免冲动。
   
   ━━━━━━━━━━━━━━━━━
   
   🎴 牌面信息
   • 过去：战车（正位）
     控制，意志力，胜利，决心
   
   • 现在：恋人（逆位）
     不和谐，失衡，错误的价值观
   
   • 未来：力量（逆位）
     软弱，自我怀疑，缺乏自律
   
   ━━━━━━━━━━━━━━━━━
   
   💡 核心建议
   职场环境复杂，需要谨慎行事...
   
   💭 点击下方「📜 详细解读」查看完整分析
   
   [📜 详细解读]
   [🌙 今日运势] [🔁 再占卜一次]
```

## 交互选项

### 1. 点击「📜 详细解读」

显示完整的专业解读：

```
━━━━━━━━━━━━━━━━━
🔮 塔罗详细解读 🔮
━━━━━━━━━━━━━━━━━

💭 你的问题
我应该换工作吗？

━━━━━━━━━━━━━━━━━

🎴 抽取的牌阵
🔸 过去：战车（正位）
🔸 现在：恋人（逆位）
🔸 未来：力量（逆位）

━━━━━━━━━━━━━━━━━

⭐ 我感受到你内心的召唤...

【总体预测：谨慎】
局势复杂，挑战与机遇并存...

━━━━━━━━━━━━━━━━━

【过去 - 根源】战车（正位）
战车手驾驭两匹相反方向的马...
💫 这张牌揭示: 你的过去经历...

【现在 - 焦点】恋人（逆位）
当恋人逆位，关系中的不和谐显现...
💫 这张牌揭示: 当下的你正处于...

【未来 - 趋势】力量（逆位）
当力量逆位，内在的恐惧占据上风...
💫 这张牌揭示: 若按当前轨迹发展...

━━━━━━━━━━━━━━━━━

【大师建议】
职场环境复杂，需要谨慎行事...

【行动指引】
✦ 关于过去: 把握这股正向能量
✦ 关于现在: 觉察到挑战，调整策略
✦ 关于未来: 觉察到挑战，调整策略

━━━━━━━━━━━━━━━━━

🕯️ 塔罗大师寄语
命运并非刻在石头上...

[🌙 今日运势] [🔁 再占卜一次]
```

### 2. 点击「🌙 今日运势」

显示单张牌的今日运势：

```
━━━━━━━━━━━━━━━━━
🔮 张三 的今日塔罗 🔮

🃏 牌面: The Sun (太阳) (正位)
✨ 解读: 积极，有趣，温暖，成功，活力

💡 大师赠言: 心诚则灵，命由己造。
━━━━━━━━━━━━━━━━━

💫 每日仅可抽取一次，明日再来吧

[🔮 塔罗占卜]
```

### 3. 点击「🔁 再占卜一次」

返回初始状态：

```
🔮 请重新输入 /tarot [问题] 开启新的占卜。
```

### 4. 从今日运势点击「🔮 塔罗占卜」

```
🔮 请输入 /tarot [问题] 开启新的占卜。

例如：
• /tarot 我应该换工作吗？
• /tarot 他喜欢我吗？
```

## 功能特点

### 精简版（默认显示）
- ✅ 快速浏览：用户可以快速了解占卜结果
- ✅ 简洁明了：只显示核心牌意和建议
- ✅ 减少刷屏：避免信息过载
- ✅ 引导探索：通过按钮引导用户深入了解

### 详细版（点击查看）
- ✅ 深度解读：每张牌都有大师级的详细诠释
- ✅ 完整分析：包含开场白、详细解读、行动指引、寄语
- ✅ 专业体验：让真正感兴趣的用户获得专业级服务
- ✅ 按需展开：避免强制所有用户接收大量信息

### 今日运势
- ✅ 单张抽牌：简单快速的日常占卜
- ✅ 每日限制：增加神秘感和期待感
- ✅ 独立功能：可以不占卜也能查看运势

## 数据流转

```
用户输入问题
    ↓
context.user_data['tarot_question'] = question
    ↓
用户点击抽牌
    ↓
spread = tarot_deck.get_three_card_spread()
    ↓
context.user_data['tarot_spread'] = spread
context.user_data['tarot_question'] = question
    ↓
显示精简版 (generate_brief_interpretation)
    ↓
用户选择：
    ├─ 详细解读 → 从 user_data 读取 spread 和 question
    │              → generate_spread_interpretation
    │              → 显示详细版
    │
    ├─ 今日运势 → 新抽一张牌
    │              → get_simple_reading
    │              → 显示单张牌运势
    │
    └─ 再占卜一次 → 清空状态，提示重新输入命令
```

## 按钮回调映射

| 按钮文字 | callback_data | 处理函数 |
|---------|---------------|----------|
| 🎴 抽牌 | draw_tarot | tarot_callback_handler |
| 📜 详细解读 | tarot_detail | tarot_detail_callback |
| 🌙 今日运势 | tarot_luck | tarot_luck_callback |
| 🔁 再占卜一次 | tarot_again | tarot_again_callback |
| 🔮 塔罗占卜 | back_to_tarot | back_to_tarot_callback |

## 用户体验优势

1. **渐进式信息披露**
   - 先看概要，感兴趣再看详情
   - 避免信息轰炸

2. **灵活的交互路径**
   - 想看详情？点击详细解读
   - 只想看运势？点击今日运势
   - 不满意结果？点击再占卜

3. **保持神秘感**
   - 动画效果营造仪式感
   - 分步展示保持期待感

4. **友好的引导**
   - 清晰的按钮标识
   - 合理的功能分组
   - 恰当的提示文案
